<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Elite Voting Portal</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Syncopate:wght@700&display=swap" rel="stylesheet">

<style>
:root {
  --bg-main: #050507;
  --bg-panel: rgba(255,255,255,0.035);
  --border-soft: rgba(255,255,255,0.08);
  --accent: #00e5ff;
  --accent-dim: rgba(0,229,255,0.25);
  --text-main: #e8f1f5;
  --text-dim: #8fa3ad;
}

body {
  background:
    radial-gradient(800px at 70% -10%, rgba(0,229,255,0.08), transparent 60%),
    radial-gradient(600px at -10% 20%, rgba(255,255,255,0.04), transparent 50%),
    var(--bg-main);
  color: var(--text-main);
  font-family: 'Inter', system-ui, sans-serif;
  min-height: 100vh;
  letter-spacing: 0.2px;
}

/* ===== AUTH OVERLAY ===== */
#authOverlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg, #050507, #030305);
  display: grid;
  place-items: center;
  z-index: 999;
  transition: transform 1s cubic-bezier(0.85, 0, 0.15, 1);
}

.auth-card {
  width: 420px;
  padding: 3.2rem;
  border-radius: 24px;
  background: var(--bg-panel);
  border: 1px solid var(--border-soft);
  backdrop-filter: blur(22px);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.02),
    0 40px 120px rgba(0,0,0,0.6);
  text-align: center;
}

.auth-card h2 {
  font-family: 'Syncopate', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 4px;
  margin-bottom: 1.5rem;
}

.auth-card p {
  color: var(--text-dim);
  font-size: 0.9rem;
  margin-bottom: 2rem;
}

/* ===== INPUT ===== */
.elite-input {
  width: 100%;
  padding: 14px 18px;
  border-radius: 14px;
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border-soft);
  color: var(--text-main);
  outline: none;
  margin-bottom: 1.8rem;
}

.elite-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent-dim);
}

/* ===== BUTTON ===== */
.btn-elite {
  width: 100%;
  padding: 14px;
  border-radius: 999px;
  background: linear-gradient(
    135deg,
    var(--accent),
    #7af6ff
  );
  color: #001014;
  font-weight: 700;
  letter-spacing: 1.5px;
  border: none;
  cursor: pointer;
  transition: transform .25s ease, box-shadow .25s ease;
}

.btn-elite:hover {
  transform: translateY(-1px);
  box-shadow: 0 12px 40px rgba(0,229,255,0.45);
}

/* ===== MAIN PANEL ===== */
#mainContent {
  max-width: 760px;
  margin: auto;
  padding-top: 6rem;
  transition: opacity .8s ease;
}

#progress {
  font-size: 0.75rem;
  color: var(--text-dim);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 0.6rem;
}

#voteTitle {
  font-family: 'Syncopate', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 3px;
  margin-bottom: 2.4rem;
}

/* ===== OPTIONS ===== */
.glass-card {
  background: var(--bg-panel);
  border: 1px solid var(--border-soft);
  border-radius: 22px;
  padding: 1.6rem;
  backdrop-filter: blur(18px);
}

.vote-item {
  padding: 1rem 1.2rem;
  border-radius: 14px;
  background: rgba(255,255,255,0.02);
  border: 1px solid transparent;
  margin-bottom: 0.7rem;
  cursor: pointer;
  transition: all .25s ease;
}

.vote-item:hover {
  border-color: var(--border-soft);
}

.vote-item.selected {
  border-color: var(--accent);
  background:
    linear-gradient(90deg, rgba(0,229,255,0.18), transparent 70%);
  box-shadow: inset 4px 0 0 var(--accent);
}

/* ===== SUBMIT ===== */
#submitVote {
  margin-top: 1.6rem;
}

#submitVote:disabled {
  opacity: 0.35;
  cursor: not-allowed;
}
</style>

</style>
</head>

<body>

<!-- AUTH -->
<div id="authOverlay">
  <div class="auth-card">
    <h2 class="title-font mb-4">Identify Yourself</h2>
    <input id="userName" class="form-control mb-3" placeholder="Enter name">
    <button id="loginBtn" class="btn-elite w-100">Enter</button>
  </div>
</div>

<!-- APP -->
<div class="container py-5" id="mainContent" style="opacity:0">
  <div class="text-center mb-4">
    <p id="progress"></p>
    <h1 id="voteTitle" class="title-font h4"></h1>
  </div>

  <div id="optionsContainer" class="glass-card mb-3"></div>
  <button id="submitVote" class="btn-elite w-100" disabled>Submit Vote</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { firebaseConfig } from "/ochkovote2025-2026/firebase-config.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* STATE */
let categories = [];
let currentIndex = 0;
let voteLimit = 1;
let selected = new Set();

/* LOAD DATA */
async function loadData() {
  const res = await fetch("data.json");
  const json = await res.json();
  categories = Object.entries(json);
  loadCategory();
}

/* LOAD CATEGORY */
function loadCategory() {
  selected.clear();
  const [key, options] = categories[currentIndex];

  const match = key.match(/\(q(\d+)/);
  voteLimit = match ? Number(match[1]) : 1;

  voteTitle.innerText = key.split("(")[0];
  progress.innerText = `Category ${currentIndex + 1} / ${categories.length}`;

  optionsContainer.innerHTML = "";
  submitVote.disabled = true;

  options.forEach(opt => {
    const div = document.createElement("div");
    div.className = "vote-item";
    div.innerText = opt;

    div.onclick = () => {
      if (selected.has(opt)) {
        selected.delete(opt);
        div.classList.remove("selected");
      } else if (selected.size < voteLimit) {
        selected.add(opt);
        div.classList.add("selected");
      }
      submitVote.disabled = selected.size === 0;
    };

    optionsContainer.appendChild(div);
  });
}

/* LOGIN */
loginBtn.onclick = async () => {
  const name = userName.value.trim();
  if (name.length < 2) return alert("Enter name");

  localStorage.setItem("name", name);
  await signInAnonymously(auth);

  authOverlay.style.transform = "translateY(-100%)";
  mainContent.style.opacity = 1;

  loadData();
};

/* SUBMIT */
submitVote.onclick = async () => {
  const [key] = categories[currentIndex];

  await set(
    ref(db, `votes/${auth.currentUser.uid}/${key}`),
    {
      selections: Array.from(selected),
      timestamp: Date.now()
    }
  );

  currentIndex++;
  if (currentIndex < categories.length) {
    loadCategory();
  } else {
    alert("Voting complete. Thank you!");
    location.reload();
  }
};
</script>

</body>
</html>
